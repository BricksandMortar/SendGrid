$(function() {
  // build side menu
  var html = '';

  $('.bs-docs-section').each(function() {
    var h1 = $(this).find('h1[id]').first(),
      h23 = $(this).find('h2[id], h3[id]');

    if (h1.length) {
      html += '<li><a href="#' + h1[0].id + '">' + h1.clone().children().remove().end().text() + '</a>';

      if (h23.length) {
        html += '<ul class="nav">';
        h23.each(function() {
          html += '<li><a href="#' + this.id + '">' + $(this).clone().children().remove().end().text() + '</a></li>';
        });
        html += '</ul>';
      }

      html += '</li>';
    }
  });

  if (html == '') {
    $('[role=complementary]').hide();
    $('[role=main]').toggleClass('col-md-9 col-md-12');
  } else {
    $('.bs-docs-sidenav').html(html);
  }

  $(function() {

    // Scrollspy
    var $window = $(window);
    var $body = $(document.body);

    $body.scrollspy({
      target: '.bs-docs-sidebar'
    });
    $window.on('load', function() {
      $body.scrollspy('refresh');
    });

    // Kill links
    $('.bs-docs-container [href="#"]').click(function(e) {
      e.preventDefault();
    });

    // Sidenav affixing
    setTimeout(function() {
      var $sideBar = $('.bs-docs-sidebar');

      $sideBar.affix({
        offset: {
          top: function() {
            var offsetTop = $sideBar.offset().top;
            var sideBarMargin = parseInt($sideBar.children(0).css('margin-top'), 10);
            var navOuterHeight = $('.bs-docs-nav').height();

            return (this.top = offsetTop - navOuterHeight - sideBarMargin);
          },
          bottom: function() {
            return (this.bottom = $('.bs-docs-footer').outerHeight(true));
          }
        }
      });
    }, 100);

    setTimeout(function() {
      $('.bs-top').affix();
    }, 100);
  });
});
